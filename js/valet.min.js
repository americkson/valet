!function(e){Drupal.behaviors.valet={dataLabel:1.8==parseFloat(e.ui.version)?"autocomplete":"ui-Autocomplete",dataItemLabel:1.8==parseFloat(e.ui.version)?"item.autocomplete":"ui-autocomplete-item",once:!1,open:!1,links:!1,results:!1,weight:!1,selected:!1,requestTerm:"",valetSelector:"",valetSearchSelector:"",shifted:!1,attach:function(){var t=this;t.once||(t.once=!0,t.valetSelector=e("#valet"),t.valetSelector.length&&(t.valetSearchSelector=e("#valet-search"),t.valetSelector.hide(),Drupal.settings.valet.purge||Lawnchair({name:"valet"},function(){this.get("links",function(e){t.links="undefined"!=e?e:!1}),this.get("weight",function(e){t.weights="undefined"!=e?e:!1})}),t.links||e.ajax({url:Drupal.settings.basePath+"admin/valet/lookup",dataType:"json",success:function(e){Lawnchair({name:"valet"},function(){this.remove("links"),this.save(e),t.links=e})},error:function(e,t,a){alert(e.status),alert(a)}}),t.valetSearchSelector.autocomplete({minLength:2,delay:0,autoFocus:!0,appendTo:"#valet-results",source:function(e,a){t.resultsFilter(e.term),a(t.results)},focus:function(e,a){return t.selected=a.item,t.childrenCheck(),!1},select:function(e,a){return a.item?(t.go(a.item.label,a.item.value),!1):void 0},open:function(){var a=e(this).data(Drupal.behaviors.valet.dataLabel);menu=a.menu,menu.activate&&menu.activate(e.Event({type:"mouseenter"}),menu.element.children().first()),this.shiftSet||(this.shiftSet=!0,e(this).bind("keydown","shift",function(){t.shifted=!0}).bind("keyup","shift",function(){t.shifted=!1}))}}).data(Drupal.behaviors.valet.dataLabel)._renderItem=function(a,n){var i=t.shortcut(n.value),l=t.children(n),r=n.value.length>85?n.value.substring(0,85)+"...":n.value.length>0?n.value:"/";return e("<li></li>").data(Drupal.behaviors.valet.dataItemLabel,n).append("<a><strong>"+n.label+"</strong><br><em>"+r+"</em>"+l+i+"</a>").appendTo(a)},e(document).bind("keydown",Drupal.settings.valet.modifier+"+"+Drupal.settings.valet.key,function(){return t.show(),!1}),e(document).bind("keydown","esc",function(){t.hide()}),t.valetSearchSelector.bind("keydown","esc",function(){t.hide()}),t.valetSearchSelector.bind("keydown",Drupal.settings.valet.modifier,function(){return t.childrenCreate(),!1}),e(document).click(function(){t.hide()}),e("#valet-search-form").submit(function(){return!1})))},resultsFilter:function(t){var a=this;if(a.requestTerm=t,!a.links)return void console.log("Valet Links Not Found!");var n=e.ui.autocomplete.filter(a.links.items,a.requestTerm);if(a.results=n.slice(0,4),a.weights&&a.weights[a.requestTerm])for(var i=a.weights[a.requestTerm],l=0;l<a.results.length;l++)a.results[l].weight=i[a.results[l].value]?i[a.results[l].value]:0;a.results.sort(a.weightSort)},go:function(t,a){var n=this;n.goSave(a),"devel/cache/clear"==a&&(a="devel/cache/clear?destination="+window.location.pathname.substring(1)),"devel/ambit/clear"==a&&(a="devel/ambit/clear?destination="+window.location.pathname.substring(1)),-1!=a.indexOf("valet/cache/clear")&&(a+="?destination="+window.location.pathname.substring(1));var i=t.replace(/<\/?[a-z][a-z0-9]*[^<>]*>/gi,"");i=i.length>28?i.substring(0,28)+"...":i;var l=a.length>40?a.substring(0,40)+"...":a.length>0?a:"/";e("#valet-results").hide(),n.valetSelector.addClass("loading"),e("#valet-loading-info").text(i),e("#valet-loading-value span").text(l),n.shifted?(n.hide(),n.shfited=!1,window.open(Drupal.settings.basePath+a)):window.location=Drupal.settings.basePath+a},goSave:function(e){var t=this;Lawnchair({name:"valet"},function(){this.get("weight",function(a){a||(a={key:"weight"}),a[t.requestTerm]||(a[t.requestTerm]={}),a[t.requestTerm][e]=a[t.requestTerm][e]?a[t.requestTerm][e]+1:1,this.save(a)})})},show:function(){var e=this;e.open=!0,e.valetSelector.fadeIn("normal"),e.valetSearchSelector.focus().data(Drupal.behaviors.valet.dataLabel)._trigger("change")},hide:function(){var t=this;t.open=!1,t.valetSelector.fadeOut("fast"),t.valetSearchSelector.unbind("keydown","1"),t.valetSearchSelector.unbind("keydown","2"),t.valetSearchSelector.unbind("keydown","3"),e("#valet-results").show(),t.valetSelector.removeClass("loading"),e("#valet-loading-info").text(""),e("#valet-loading-value span").text("")},children:function(e){return e.children?'<span class="valet-icon valet-icon-'+Drupal.settings.valet.modifier.toLowerCase()+'"></span>':""},childrenCheck:function(){{var e=this;e.selected}e.childrenRemove()},childrenCreate:function(){var t=this,a=t.selected;if(a.children&&!a.child){if(e(".valet-child").length)return;for(var n=e("#ui-active-menuitem").parent(),i=0;i<a.children.length;i++){var l=a.children[i];l.child=!0,l.weight=i;var r="";0==i&&(r+=" first"),i==a.children.length-1&&(r+=" last");var s=e('<li class="ui-menu-item valet-child'+r+'" role="menuitem"></li>').data("item.autocomplete",l).append("<a>"+l.label+"</a>");n.after(s),n=s;var o=s.height();s.css({height:0}).animate({height:o},300)}}},childrenRemove:function(){var t=this,a=t.selected,n=e(".valet-child");!a.child&&n.length&&n.animate({height:0},300,function(){e(this).remove()})},shortcut:function(e){var t=this,a="";switch(e){case t.results[0].value:a="return";break;case t.results[1].value:a="1";break;case t.results[2].value:a="2";break;case t.results[3].value:a="3"}var n=parseInt(a);return n&&(t.valetSearchSelector.unbind("keydown",a),t.valetSearchSelector.bind("keydown",a,function(){t.go(t.results[n].label,t.results[n].value)})),a?'<span class="valet-icon valet-icon-'+a+'"><span>':""},weightSort:function(e,t){return e.weight>t.weight?-1:e.weight<t.weight?1:0}}}(jQuery);
